{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v4.json", "dbt_version": "1.4.4", "generated_at": "2023-12-19T12:17:26.042515Z", "invocation_id": "08e64428-1411-44b7-a7b5-026fa2ba50d7", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:16:38.859588Z", "completed_at": "2023-12-19T12:16:38.865101Z"}, {"name": "execute", "started_at": "2023-12-19T12:16:38.866516Z", "completed_at": "2023-12-19T12:16:41.181953Z"}], "thread_id": "Thread-1", "execution_time": 2.3245482444763184, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_alaris_data_modified\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_alaris_data_modified__dbt_tmp\" include schema privileges as (\n    \n\nwith src as \n(\nselect \t\t    * \n                , case  when regexp_like(src_service_type, '^(0[xX])?[0-9a-fA-F]+$') \n                        then src_service_type\n                        else null\n                        end as pd_user_id_hex \n                , case  when v_currency = 'UEtS' then 'PKR'\n                        when v_currency = 'RUdQ' then 'EGP'\n                        when v_currency = 'RVVS' then 'EUR'\n                        when v_currency = 'QUVE' then 'AED'\n                        when v_currency = 'VVNE' then 'USD'\n                        else null\n                        end as currency\n                , case  when v_currency = 'UEtS' then 277.69 --'PKR'\n                        when v_currency = 'RUdQ' then 30.9 --'EGP'\n                        when v_currency = 'RVVS' then 0.94 --'EUR'\n                        when v_currency = 'QUVE' then 3.67 --'AED'\n                        when v_currency = 'VVNE' then 1 --'USD'\n                        else null\n                        end as fx_rate\n                --, case  when sar_parts = 0 and is_successful = 1 then 1 else sar_parts end as operator_traffic\nfrom\t\t    \"verticadb\".\"standard\".\"fact_acdr\"\nwhere           1=1\n                and is_successful = 1 \n                --and v_rate_value <> 0\n                --and sar_parts <> 0 --for all incoming_protocol = 'HTTP' sar_parts = 0\n)\n, base as\n(\nselect \t\t   date_nk\n                , local_id\n                , src_service_type\n                , hex_to_integer(pd_user_id_hex) as pd_user_id\n                , ani as sender_id\n                , mccmnc\n                , country\n                , incoming_protocol\n                , c_channel_id as connection_type\n                , edr_dial_code as country_code\n                , dst_channel_id\n                , client_operator_name\n                , vendoroperator_name as vendor_name\n                , vendor_prod_id\n                , client_prod_id\n                , status\n                , dlr_status\n                , sar_parts \n                , is_successful\n                --, operator_traffic\n                , v_rate_value as cost_rate\n                , currency||' '||v_rate_value as cost_rate_cat\n                --, v_rate_value * operator_traffic as COGS\n                , currency\n                , fx_rate\n                , v_rate_value / fx_rate as cost_rate_USD\n                --, v_rate_value * operator_traffic / fx_rate as COGS_USD\nfrom \t\t    src\n)\nselect \t\t  lm.Master_Account_ID\n                , lm.Master_Account_Name\n                , lm.Charging_ID_L0\n                , b.*\t\t\nfrom \t\tbase as b\nleft join \t\"verticadb\".\"analytics\".\"lm_v_master_account_mapping\" as lm\non\t        b.pd_user_id = lm.PD_User_ID_L0\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_alaris_data_modified\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_alaris_data_modified__dbt_tmp\" include schema privileges as (\n    \n\nwith src as \n(\nselect \t\t    * \n                , case  when regexp_like(src_service_type, '^(0[xX])?[0-9a-fA-F]+$') \n                        then src_service_type\n                        else null\n                        end as pd_user_id_hex \n                , case  when v_currency = 'UEtS' then 'PKR'\n                        when v_currency = 'RUdQ' then 'EGP'\n                        when v_currency = 'RVVS' then 'EUR'\n                        when v_currency = 'QUVE' then 'AED'\n                        when v_currency = 'VVNE' then 'USD'\n                        else null\n                        end as currency\n                , case  when v_currency = 'UEtS' then 277.69 --'PKR'\n                        when v_currency = 'RUdQ' then 30.9 --'EGP'\n                        when v_currency = 'RVVS' then 0.94 --'EUR'\n                        when v_currency = 'QUVE' then 3.67 --'AED'\n                        when v_currency = 'VVNE' then 1 --'USD'\n                        else null\n                        end as fx_rate\n                --, case  when sar_parts = 0 and is_successful = 1 then 1 else sar_parts end as operator_traffic\nfrom\t\t    \"verticadb\".\"standard\".\"fact_acdr\"\nwhere           1=1\n                and is_successful = 1 \n                --and v_rate_value <> 0\n                --and sar_parts <> 0 --for all incoming_protocol = 'HTTP' sar_parts = 0\n)\n, base as\n(\nselect \t\t   date_nk\n                , local_id\n                , src_service_type\n                , hex_to_integer(pd_user_id_hex) as pd_user_id\n                , ani as sender_id\n                , mccmnc\n                , country\n                , incoming_protocol\n                , c_channel_id as connection_type\n                , edr_dial_code as country_code\n                , dst_channel_id\n                , client_operator_name\n                , vendoroperator_name as vendor_name\n                , vendor_prod_id\n                , client_prod_id\n                , status\n                , dlr_status\n                , sar_parts \n                , is_successful\n                --, operator_traffic\n                , v_rate_value as cost_rate\n                , currency||' '||v_rate_value as cost_rate_cat\n                --, v_rate_value * operator_traffic as COGS\n                , currency\n                , fx_rate\n                , v_rate_value / fx_rate as cost_rate_USD\n                --, v_rate_value * operator_traffic / fx_rate as COGS_USD\nfrom \t\t    src\n)\nselect \t\t  lm.Master_Account_ID\n                , lm.Master_Account_Name\n                , lm.Charging_ID_L0\n                , b.*\t\t\nfrom \t\tbase as b\nleft join \t\"verticadb\".\"analytics\".\"lm_v_master_account_mapping\" as lm\non\t        b.pd_user_id = lm.PD_User_ID_L0\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.COGS.oy_dbt_alaris_data_modified"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:16:41.188399Z", "completed_at": "2023-12-19T12:16:41.194465Z"}, {"name": "execute", "started_at": "2023-12-19T12:16:41.195143Z", "completed_at": "2023-12-19T12:16:43.494853Z"}], "thread_id": "Thread-1", "execution_time": 2.308525800704956, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_cost_update_Dyana_B\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_cost_update_Dyana_B__dbt_tmp\" include schema privileges as (\n    with r as\n(\nselect \t\t\tdistinct\n\t\t\t\tcountry_id||'/'||operator_id||'/'||network_name as cost_id\n\t\t\t\t, country_id, operator_id, network_name , price, currency\n\t\t\t\t, case  when currency='USD' then price::NUMERIC\n                        when currency='SAR' then price::NUMERIC/3.75\n                        when currency='AED' then price::NUMERIC/3.67\n                        end as cost_rate_USD\n\t\t\t\t, effective_date as effective_from\nfrom \t\t\t\"verticadb\".\"raw\".\"mprocra__abl_operator_prices\"\nwhere \t\t\ttype_of_route <> 'INTERNATIONAL'\norder by \t\tcost_id \n)\n, lead as \n(\nselect \t\t\tDENSE_RANK() over (order by cost_id) as drnk\n\t\t\t\t, count(cost_id) over (partition by cost_id) as cnt\n\t\t\t\t, *\n\t\t\t\t, lead(effective_from, 1) over (partition by cost_id order by effective_from) as effective_to\nfrom \t\t\tr\n)\nselect \t\t\t*\n\t\t\t\t, case when effective_to is null then current_date+1 else effective_to end as effective_to_var\nfrom \t\t\tlead\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_cost_update_Dyana_B\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_cost_update_Dyana_B__dbt_tmp\" include schema privileges as (\n    with r as\n(\nselect \t\t\tdistinct\n\t\t\t\tcountry_id||'/'||operator_id||'/'||network_name as cost_id\n\t\t\t\t, country_id, operator_id, network_name , price, currency\n\t\t\t\t, case  when currency='USD' then price::NUMERIC\n                        when currency='SAR' then price::NUMERIC/3.75\n                        when currency='AED' then price::NUMERIC/3.67\n                        end as cost_rate_USD\n\t\t\t\t, effective_date as effective_from\nfrom \t\t\t\"verticadb\".\"raw\".\"mprocra__abl_operator_prices\"\nwhere \t\t\ttype_of_route <> 'INTERNATIONAL'\norder by \t\tcost_id \n)\n, lead as \n(\nselect \t\t\tDENSE_RANK() over (order by cost_id) as drnk\n\t\t\t\t, count(cost_id) over (partition by cost_id) as cnt\n\t\t\t\t, *\n\t\t\t\t, lead(effective_from, 1) over (partition by cost_id order by effective_from) as effective_to\nfrom \t\t\tr\n)\nselect \t\t\t*\n\t\t\t\t, case when effective_to is null then current_date+1 else effective_to end as effective_to_var\nfrom \t\t\tlead\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.COGS.oy_dbt_cost_update_Dyana_B"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:16:43.499669Z", "completed_at": "2023-12-19T12:16:43.504225Z"}, {"name": "execute", "started_at": "2023-12-19T12:16:43.504852Z", "completed_at": "2023-12-19T12:17:19.895762Z"}], "thread_id": "Thread-1", "execution_time": 36.39826464653015, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_alaris_traffic_cost\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_alaris_traffic_cost__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect          * \nfrom            \"verticadb\".\"analytics\".\"oy_dbt_alaris_data_modified\"\nwhere           1=1\n                and is_successful = 1\n                and date_nk >= '2023-11-17'\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_alaris_traffic_cost\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_alaris_traffic_cost__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect          * \nfrom            \"verticadb\".\"analytics\".\"oy_dbt_alaris_data_modified\"\nwhere           1=1\n                and is_successful = 1\n                and date_nk >= '2023-11-17'\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.COGS.oy_dbt_alaris_traffic_cost"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:17:19.901441Z", "completed_at": "2023-12-19T12:17:19.906134Z"}, {"name": "execute", "started_at": "2023-12-19T12:17:19.906876Z", "completed_at": "2023-12-19T12:17:22.274859Z"}], "thread_id": "Thread-1", "execution_time": 2.375965118408203, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_KSA_COGS_excl_failover\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover__dbt_tmp\" include schema privileges as (\n    \n\nselect \t\t    t.*\n                , p.price as cost_rate\n                , p.currency\n                , p.cost_rate_USD\n                , t.units*p.price as COGS\n                , t.units*p.cost_rate_USD as COGS_USD\nfrom \t\t    \"verticadb\".\"analytics\".\"oy_dbt_traffic_operator_agg_KSA\" as t \n----------------\nleft join \t    \"verticadb\".\"analytics\".\"oy_dbt_cost_update_Dyana_B\" as p\non \t\t\t    t.cost_id = p.cost_id \n                and t.date_nk >= p.effective_from \n                and t.date_nk < p.effective_to_var\n----------------\nwhere\t\t    1=1\n                and t.date_nk >= '2023-08-01'\n                and p.price is not null -- exluding failovers\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_KSA_COGS_excl_failover\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover__dbt_tmp\" include schema privileges as (\n    \n\nselect \t\t    t.*\n                , p.price as cost_rate\n                , p.currency\n                , p.cost_rate_USD\n                , t.units*p.price as COGS\n                , t.units*p.cost_rate_USD as COGS_USD\nfrom \t\t    \"verticadb\".\"analytics\".\"oy_dbt_traffic_operator_agg_KSA\" as t \n----------------\nleft join \t    \"verticadb\".\"analytics\".\"oy_dbt_cost_update_Dyana_B\" as p\non \t\t\t    t.cost_id = p.cost_id \n                and t.date_nk >= p.effective_from \n                and t.date_nk < p.effective_to_var\n----------------\nwhere\t\t    1=1\n                and t.date_nk >= '2023-08-01'\n                and p.price is not null -- exluding failovers\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.COGS.oy_dbt_KSA_COGS_excl_failover"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:17:22.279550Z", "completed_at": "2023-12-19T12:17:22.283777Z"}, {"name": "execute", "started_at": "2023-12-19T12:17:22.284576Z", "completed_at": "2023-12-19T12:17:24.742944Z"}], "thread_id": "Thread-1", "execution_time": 2.4654858112335205, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_avg_cost_rate_account_agg\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg__dbt_tmp\" include schema privileges as (\n    select \t\t    Master_Account_ID \n                , Master_Account_Name \n                , date_nk \n                , count(*) as operator_traffic\n                , sum(cost_rate_USD) as COGS_USD\n                , sum(cost_rate_USD)/count(*) as avg_cost_rate_USD\nfrom \t\t    \"verticadb\".\"analytics\".\"oy_dbt_alaris_traffic_cost\"\ngroup by \t    1,2,3\n--order by \t    Master_Account_ID\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"COGS\", \"target_name\": \"dev\", \"node_id\": \"model.COGS.oy_dbt_avg_cost_rate_account_agg\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg__dbt_tmp\" include schema privileges as (\n    select \t\t    Master_Account_ID \n                , Master_Account_Name \n                , date_nk \n                , count(*) as operator_traffic\n                , sum(cost_rate_USD) as COGS_USD\n                , sum(cost_rate_USD)/count(*) as avg_cost_rate_USD\nfrom \t\t    \"verticadb\".\"analytics\".\"oy_dbt_alaris_traffic_cost\"\ngroup by \t    1,2,3\n--order by \t    Master_Account_ID\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.COGS.oy_dbt_avg_cost_rate_account_agg"}], "elapsed_time": 51.373669147491455, "args": {"write_json": true, "use_colors": true, "printer_width": 80, "version_check": true, "partial_parse": true, "static_parser": true, "profiles_dir": "/Users/oleg/.dbt", "send_anonymous_usage_stats": true, "quiet": false, "no_print": false, "cache_selected_only": false, "which": "run", "rpc_method": "run", "indirect_selection": "eager"}}
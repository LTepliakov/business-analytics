{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v4.json", "dbt_version": "1.4.4", "generated_at": "2023-12-19T12:18:58.094013Z", "invocation_id": "eca9753f-9ea1-49f4-8652-5fd12e252909", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:17.015333Z", "completed_at": "2023-12-19T12:18:17.021004Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:17.021875Z", "completed_at": "2023-12-19T12:18:20.742294Z"}], "thread_id": "Thread-1", "execution_time": 3.7293639183044434, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_KSA_COGS_excl_failover_agg\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover_agg__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect \t\tdate_nk\n\t\t\t, charging_id \n\t\t\t, Master_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, destination_country \n\t\t\t, operator_name \n\t\t\t, network_name \n\t\t\t, country_id \n\t\t\t, operator_id \n\t\t\t, cost_id \n\t\t\t, cost_rate \n\t\t\t, currency \n\t\t\t, cost_rate_USD \n\t\t\t, sum(units) as units\n\t\t\t, sum(COGS) as COGS\n\t\t\t, sum(COGS_USD) as COGS_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover\"\nwhere \t\t1=1\n\t\t\tand date_nk >= '2023-08-01' \ngroup by \t1,2,3,4,5,6,7,8,9,10,11,12,13\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_KSA_COGS_excl_failover_agg\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover_agg__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect \t\tdate_nk\n\t\t\t, charging_id \n\t\t\t, Master_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, destination_country \n\t\t\t, operator_name \n\t\t\t, network_name \n\t\t\t, country_id \n\t\t\t, operator_id \n\t\t\t, cost_id \n\t\t\t, cost_rate \n\t\t\t, currency \n\t\t\t, cost_rate_USD \n\t\t\t, sum(units) as units\n\t\t\t, sum(COGS) as COGS\n\t\t\t, sum(COGS_USD) as COGS_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover\"\nwhere \t\t1=1\n\t\t\tand date_nk >= '2023-08-01' \ngroup by \t1,2,3,4,5,6,7,8,9,10,11,12,13\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_KSA_COGS_excl_failover_agg"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:20.748773Z", "completed_at": "2023-12-19T12:18:20.753033Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:20.753662Z", "completed_at": "2023-12-19T12:18:23.121320Z"}], "thread_id": "Thread-1", "execution_time": 2.3747589588165283, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_clients_with_invalid_selling_rate\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate__dbt_tmp\" include schema privileges as (\n    select \t\tMaster_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, ocs_selling_rate\n\t\t\t, round(sum(units),0) as units\n\t\t\t, round(sum(charge),0) as charge\n\t\t\t, round(sum(Revenue_USD),0) as Revenue_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\"\nwhere \t\t1=1 \n\t\t\tand bundle_type <> 'mb'\n\t\t\tand date_nk>='2023-08-01'\n\t\t\tand date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\tand (\n\t\t\t\tocs_selling_rate = 1\n\t\t\t\tor ocs_selling_rate = 0\n\t\t\t\tor ocs_selling_rate is null\n\t\t\t\t)\ngroup by \t1,2,3\norder by \tRevenue_USD  desc\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_clients_with_invalid_selling_rate\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate__dbt_tmp\" include schema privileges as (\n    select \t\tMaster_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, ocs_selling_rate\n\t\t\t, round(sum(units),0) as units\n\t\t\t, round(sum(charge),0) as charge\n\t\t\t, round(sum(Revenue_USD),0) as Revenue_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\"\nwhere \t\t1=1 \n\t\t\tand bundle_type <> 'mb'\n\t\t\tand date_nk>='2023-08-01'\n\t\t\tand date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\tand (\n\t\t\t\tocs_selling_rate = 1\n\t\t\t\tor ocs_selling_rate = 0\n\t\t\t\tor ocs_selling_rate is null\n\t\t\t\t)\ngroup by \t1,2,3\norder by \tRevenue_USD  desc\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_clients_with_invalid_selling_rate"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:23.126136Z", "completed_at": "2023-12-19T12:18:23.130720Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:23.131370Z", "completed_at": "2023-12-19T12:18:25.498296Z"}], "thread_id": "Thread-1", "execution_time": 2.374216079711914, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_clients_with_invalid_selling_rate_International\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate_International__dbt_tmp\" include schema privileges as (\n    select \t\tMaster_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, ocs_selling_rate\n\t\t\t, round(sum(units),0) as units\n\t\t\t, round(sum(charge),0) as charge\n\t\t\t, round(sum(Revenue_USD),0) as Revenue_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms\"\nwhere \t\t1=1 \n\t\t\tand bundle_type <> 'mb'\n\t\t\tand date_nk>='2023-08-01'\n\t\t\t--and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\tand (\n\t\t\t\tocs_selling_rate = 1\n\t\t\t\tor ocs_selling_rate = 0\n\t\t\t\tor ocs_selling_rate is null\n\t\t\t\t)\n\t\t\tand traffic_is = 'International'\ngroup by \t1,2,3\norder by \tRevenue_USD  desc\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_clients_with_invalid_selling_rate_International\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate_International__dbt_tmp\" include schema privileges as (\n    select \t\tMaster_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, ocs_selling_rate\n\t\t\t, round(sum(units),0) as units\n\t\t\t, round(sum(charge),0) as charge\n\t\t\t, round(sum(Revenue_USD),0) as Revenue_USD \nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms\"\nwhere \t\t1=1 \n\t\t\tand bundle_type <> 'mb'\n\t\t\tand date_nk>='2023-08-01'\n\t\t\t--and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\tand (\n\t\t\t\tocs_selling_rate = 1\n\t\t\t\tor ocs_selling_rate = 0\n\t\t\t\tor ocs_selling_rate is null\n\t\t\t\t)\n\t\t\tand traffic_is = 'International'\ngroup by \t1,2,3\norder by \tRevenue_USD  desc\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_clients_with_invalid_selling_rate_International"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:25.502801Z", "completed_at": "2023-12-19T12:18:25.506643Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:25.507343Z", "completed_at": "2023-12-19T12:18:27.987200Z"}], "thread_id": "Thread-1", "execution_time": 2.4864299297332764, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_no_mb_clients\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients__dbt_tmp\" include schema privileges as (\n    with base as\n(\nselect \t\t    Master_Account_ID \n                , Master_Account_Name \n                , bundle_type \n                , round(sum(units),0) as units\n                , round(sum(charge),0) as charge\n                , round(sum(Revenue_USD),0) as Revenue_USD \nfrom\t\t    \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\"\nwhere \t\t    date_nk>='2023-08-01'\n                and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\ngroup by \t    1,2,3\norder by \t    Master_Account_ID \n)\n, pmix as\n(\nselect \t\t    *\n\t\t\t    , count(Master_Account_ID) over (partition by Master_Account_ID ) as cnt\nfrom \t\t    base\n)\nselect \t\t    *\nfrom \t\t    pmix\nwhere \t\t    cnt = 1 \n                and bundle_type = 'package'\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_no_mb_clients\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients__dbt_tmp\" include schema privileges as (\n    with base as\n(\nselect \t\t    Master_Account_ID \n                , Master_Account_Name \n                , bundle_type \n                , round(sum(units),0) as units\n                , round(sum(charge),0) as charge\n                , round(sum(Revenue_USD),0) as Revenue_USD \nfrom\t\t    \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\"\nwhere \t\t    date_nk>='2023-08-01'\n                and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\ngroup by \t    1,2,3\norder by \t    Master_Account_ID \n)\n, pmix as\n(\nselect \t\t    *\n\t\t\t    , count(Master_Account_ID) over (partition by Master_Account_ID ) as cnt\nfrom \t\t    base\n)\nselect \t\t    *\nfrom \t\t    pmix\nwhere \t\t    cnt = 1 \n                and bundle_type = 'package'\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_no_mb_clients"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:27.991941Z", "completed_at": "2023-12-19T12:18:27.995797Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:27.996403Z", "completed_at": "2023-12-19T12:18:31.021796Z"}], "thread_id": "Thread-1", "execution_time": 3.031994342803955, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_no_mb_clients_International\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients_International__dbt_tmp\" include schema privileges as (\n    with base as\n(\nselect \t\t    Master_Account_ID \n                , Master_Account_Name \n                , bundle_type \n                , round(sum(units),0) as units\n                , round(sum(charge),0) as charge\n                , round(sum(Revenue_USD),0) as Revenue_USD \nfrom\t\t    \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms\"\nwhere \t\t    date_nk>='2023-08-01'\n                and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n                and traffic_is = 'International'\ngroup by \t    1,2,3\norder by \t    Master_Account_ID \n)\n, pmix as\n(\nselect \t\t    *\n\t\t\t    , count(Master_Account_ID) over (partition by Master_Account_ID ) as cnt\nfrom \t\t    base\n)\nselect \t\t    *\nfrom \t\t    pmix\nwhere \t\t    cnt = 1 \n                and bundle_type = 'package'\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_no_mb_clients_International\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients_International__dbt_tmp\" include schema privileges as (\n    with base as\n(\nselect \t\t    Master_Account_ID \n                , Master_Account_Name \n                , bundle_type \n                , round(sum(units),0) as units\n                , round(sum(charge),0) as charge\n                , round(sum(Revenue_USD),0) as Revenue_USD \nfrom\t\t    \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms\"\nwhere \t\t    date_nk>='2023-08-01'\n                and date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n                and traffic_is = 'International'\ngroup by \t    1,2,3\norder by \t    Master_Account_ID \n)\n, pmix as\n(\nselect \t\t    *\n\t\t\t    , count(Master_Account_ID) over (partition by Master_Account_ID ) as cnt\nfrom \t\t    base\n)\nselect \t\t    *\nfrom \t\t    pmix\nwhere \t\t    cnt = 1 \n                and bundle_type = 'package'\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_no_mb_clients_International"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:31.026487Z", "completed_at": "2023-12-19T12:18:31.031595Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:31.032212Z", "completed_at": "2023-12-19T12:18:43.208602Z"}], "thread_id": "Thread-1", "execution_time": 12.184170961380005, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_KSA\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith base as \n(\nselect \t\t    c.*\n                , case when b.Master_Account_ID is not null then '1' else 0 end as no_mb_client\n                , case when i.Master_Account_ID is not null then '1' else 0 end as sell_rate_invalid\nfrom            \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\" as c\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients\") as b \non              c.Master_Account_ID = b.Master_Account_ID\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate\") as i \non              c.Master_Account_ID = i.Master_Account_ID\nwhere           1=1\n                and c.date_nk >= '2023-08-01' \n                --and c.date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\t\t--and c.cost_id is not null -- to exclude failovers\n)\nselect          * \nfrom            base\nwhere           1=1\n                --and no_mb_client = 1\n                and sell_rate_invalid = 0\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_KSA\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith base as \n(\nselect \t\t    c.*\n                , case when b.Master_Account_ID is not null then '1' else 0 end as no_mb_client\n                , case when i.Master_Account_ID is not null then '1' else 0 end as sell_rate_invalid\nfrom            \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_KSA\" as c\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients\") as b \non              c.Master_Account_ID = b.Master_Account_ID\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate\") as i \non              c.Master_Account_ID = i.Master_Account_ID\nwhere           1=1\n                and c.date_nk >= '2023-08-01' \n                --and c.date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\t\t--and c.cost_id is not null -- to exclude failovers\n)\nselect          * \nfrom            base\nwhere           1=1\n                --and no_mb_client = 1\n                and sell_rate_invalid = 0\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_revenue_sms_KSA"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:43.213351Z", "completed_at": "2023-12-19T12:18:43.297969Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:43.298823Z", "completed_at": "2023-12-19T12:18:46.387123Z"}], "thread_id": "Thread-1", "execution_time": 3.1758370399475098, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_International\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith base as \n(\nselect \t\t    c.*\n                , case when b.Master_Account_ID is not null then '1' else 0 end as no_mb_client\n                , case when i.Master_Account_ID is not null then '1' else 0 end as sell_rate_invalid\nfrom            \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_International_acc_level\" as c\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients_International\") as b \non              c.Master_Account_ID = b.Master_Account_ID\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate_International\") as i \non              c.Master_Account_ID = i.Master_Account_ID\nwhere           1=1\n                and c.date_nk >= '2023-08-01' \n                --and c.date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\t\t--and c.cost_id is not null -- to exclude failovers\n)\nselect          * \nfrom            base\nwhere           1=1\n                --and no_mb_client = 1\n                and sell_rate_invalid = 0\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_International\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith base as \n(\nselect \t\t    c.*\n                , case when b.Master_Account_ID is not null then '1' else 0 end as no_mb_client\n                , case when i.Master_Account_ID is not null then '1' else 0 end as sell_rate_invalid\nfrom            \"verticadb\".\"analytics\".\"oy_dbt_consumption_agg_sms_International_acc_level\" as c\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_no_mb_clients_International\") as b \non              c.Master_Account_ID = b.Master_Account_ID\n----------------\nleft join       (select distinct Master_Account_ID from \"verticadb\".\"analytics\".\"oy_dbt_clients_with_invalid_selling_rate_International\") as i \non              c.Master_Account_ID = i.Master_Account_ID\nwhere           1=1\n                and c.date_nk >= '2023-08-01' \n                --and c.date_nk <= '2023-10-10' -- this filter is because from '2023-10-12' Alinma bank started to consume mb. I'll remove this filter later.\n\t\t\t\t--and c.cost_id is not null -- to exclude failovers\n)\nselect          * \nfrom            base\nwhere           1=1\n                --and no_mb_client = 1\n                and sell_rate_invalid = 0\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_revenue_sms_International"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:46.391932Z", "completed_at": "2023-12-19T12:18:46.395916Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:46.396582Z", "completed_at": "2023-12-19T12:18:48.599875Z"}], "thread_id": "Thread-1", "execution_time": 2.2101569175720215, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_KSA_agg\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA_agg__dbt_tmp\" include schema privileges as (\n    \n\n-- I checked that there is no \"cost_id  ilike '%internal%'\" in this table\nselect \t\trep_month \n\t\t\t, date_nk \n\t\t\t, charging_id \n\t\t\t, Master_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, cost_id \n\t\t\t, sum(units) as consumption\n\t\t\t, sum(charge) as charge\n\t\t\t, sum(chargeable_units) as chargeable_units\n\t\t\t, sum(Revenue_USD) as Revenue_USD\n\t\t\t, sum(GP_USD_estimate) as GP_USD_estimate\n\t\t\t, MAX(categorized_charge_pct) AS categorized_charge_pct\n\t\t\t, MAX(charge_with_cost_id_pct) AS charge_with_cost_id_pct\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA\"\nwhere \t\t1=1\n\t\t\t--and traffic_is = 'KSA' - it's already all KSA in analytics.oy_dbt_consumption_agg_sms_KSA\ngroup by \t1,2,3,4,5,6\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_revenue_sms_KSA_agg\"} */\n\n  create view \"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA_agg__dbt_tmp\" include schema privileges as (\n    \n\n-- I checked that there is no \"cost_id  ilike '%internal%'\" in this table\nselect \t\trep_month \n\t\t\t, date_nk \n\t\t\t, charging_id \n\t\t\t, Master_Account_ID \n\t\t\t, Master_Account_Name \n\t\t\t, cost_id \n\t\t\t, sum(units) as consumption\n\t\t\t, sum(charge) as charge\n\t\t\t, sum(chargeable_units) as chargeable_units\n\t\t\t, sum(Revenue_USD) as Revenue_USD\n\t\t\t, sum(GP_USD_estimate) as GP_USD_estimate\n\t\t\t, MAX(categorized_charge_pct) AS categorized_charge_pct\n\t\t\t, MAX(charge_with_cost_id_pct) AS charge_with_cost_id_pct\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA\"\nwhere \t\t1=1\n\t\t\t--and traffic_is = 'KSA' - it's already all KSA in analytics.oy_dbt_consumption_agg_sms_KSA\ngroup by \t1,2,3,4,5,6\n  );, Message: CommandComplete: command_tag = \"CREATE VIEW\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_revenue_sms_KSA_agg"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:48.604693Z", "completed_at": "2023-12-19T12:18:48.610801Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:48.611461Z", "completed_at": "2023-12-19T12:18:51.856660Z"}], "thread_id": "Thread-1", "execution_time": 3.254056930541992, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_gross_margin_International_acc_level\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_gross_margin_International_acc_level__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith acc_match as\n(\nselect \t\tdistinct \n\t\t\tca.Master_Account_ID, cs.Master_Account_ID as M_Acc_ID\n\t\t\t, case when cs.Master_Account_ID is not null then 1 else 0 end as account_match\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International\" as ca\nleft join \t\"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg\" as cs\non \t\t\tca.Master_Account_ID = cs.Master_Account_ID \n)\n, base as\n(\nselect \t\tca.*\n\t\t\t, am.account_match\n\t\t\t, cs.operator_traffic\n\t\t\t, cs.COGS_USD\n\t\t\t, cs.avg_cost_rate_USD\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International\" as ca\nleft join \t\"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg\" as cs\non \t\t\tca.date_nk = cs.date_nk \n\t\t\tand ca.Master_Account_ID = cs.Master_Account_ID \n------------\nleft join \tacc_match as am\non \t\t\tca.Master_Account_ID = am.Master_Account_ID\n------------\nwhere \t\t1=1\n\t\t\tand ca.date_nk >= '2023-11-17'\n\t\t\tand ca.Master_Account_Name <> 'Active monitoring'\norder by \tca.Master_Account_ID , ca.date_nk \n)\nselect \t\trep_month\n\t\t\t, date_nk\n\t\t\t, Master_Account_ID\n\t\t\t, Master_Account_Name\n\t\t\t, account_match\n\t\t\t, chargeable_units\n\t\t\t, case when operator_traffic is null and account_match=1 then 0 else operator_traffic end as operator_traffic\n\t\t\t, case when operator_traffic is null and account_match=1 then chargeable_units else chargeable_units - operator_traffic end as units_delta\n\t\t\t, case when operator_traffic is null and account_match=1 then 100 else round(100*(chargeable_units/operator_traffic - 1), 1) end as units_delta_pct\n\t\t\t, Revenue_USD\n\t\t\t, case when operator_traffic is null and account_match=1 then 0 else COGS_USD end as COGS_USD\n\t\t\t, case when operator_traffic is null and account_match=1 then Revenue_USD else Revenue_USD - COGS_USD end as Gross_Profit\n\t\t\t, case when operator_traffic is null and account_match=1 then 100 else round(100*(Revenue_USD/COGS_USD - 1), 1) end as Gross_Margin\n\t\t\t, round(100*(avg_selling_rate_USD/avg_cost_rate_USD - 1), 1) as Theoretical_Gross_Margin\n            , Revenue_USD*(avg_selling_rate_USD/avg_cost_rate_USD - 1) as  Theoretical_Gross_Profit\n\t\t\t, avg_selling_rate_USD\n\t\t\t, avg_cost_rate_USD\nfrom \t\tbase\nwhere \t\t1=1 \n\t\t\t--and account_match = 1 and operator_traffic is null\norder by \tMaster_Account_ID , date_nk\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_gross_margin_International_acc_level\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_gross_margin_International_acc_level__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nwith acc_match as\n(\nselect \t\tdistinct \n\t\t\tca.Master_Account_ID, cs.Master_Account_ID as M_Acc_ID\n\t\t\t, case when cs.Master_Account_ID is not null then 1 else 0 end as account_match\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International\" as ca\nleft join \t\"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg\" as cs\non \t\t\tca.Master_Account_ID = cs.Master_Account_ID \n)\n, base as\n(\nselect \t\tca.*\n\t\t\t, am.account_match\n\t\t\t, cs.operator_traffic\n\t\t\t, cs.COGS_USD\n\t\t\t, cs.avg_cost_rate_USD\nfrom \t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_International\" as ca\nleft join \t\"verticadb\".\"analytics\".\"oy_dbt_avg_cost_rate_account_agg\" as cs\non \t\t\tca.date_nk = cs.date_nk \n\t\t\tand ca.Master_Account_ID = cs.Master_Account_ID \n------------\nleft join \tacc_match as am\non \t\t\tca.Master_Account_ID = am.Master_Account_ID\n------------\nwhere \t\t1=1\n\t\t\tand ca.date_nk >= '2023-11-17'\n\t\t\tand ca.Master_Account_Name <> 'Active monitoring'\norder by \tca.Master_Account_ID , ca.date_nk \n)\nselect \t\trep_month\n\t\t\t, date_nk\n\t\t\t, Master_Account_ID\n\t\t\t, Master_Account_Name\n\t\t\t, account_match\n\t\t\t, chargeable_units\n\t\t\t, case when operator_traffic is null and account_match=1 then 0 else operator_traffic end as operator_traffic\n\t\t\t, case when operator_traffic is null and account_match=1 then chargeable_units else chargeable_units - operator_traffic end as units_delta\n\t\t\t, case when operator_traffic is null and account_match=1 then 100 else round(100*(chargeable_units/operator_traffic - 1), 1) end as units_delta_pct\n\t\t\t, Revenue_USD\n\t\t\t, case when operator_traffic is null and account_match=1 then 0 else COGS_USD end as COGS_USD\n\t\t\t, case when operator_traffic is null and account_match=1 then Revenue_USD else Revenue_USD - COGS_USD end as Gross_Profit\n\t\t\t, case when operator_traffic is null and account_match=1 then 100 else round(100*(Revenue_USD/COGS_USD - 1), 1) end as Gross_Margin\n\t\t\t, round(100*(avg_selling_rate_USD/avg_cost_rate_USD - 1), 1) as Theoretical_Gross_Margin\n            , Revenue_USD*(avg_selling_rate_USD/avg_cost_rate_USD - 1) as  Theoretical_Gross_Profit\n\t\t\t, avg_selling_rate_USD\n\t\t\t, avg_cost_rate_USD\nfrom \t\tbase\nwhere \t\t1=1 \n\t\t\t--and account_match = 1 and operator_traffic is null\norder by \tMaster_Account_ID , date_nk\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_gross_margin_International_acc_level"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-19T12:18:51.861787Z", "completed_at": "2023-12-19T12:18:51.867047Z"}, {"name": "execute", "started_at": "2023-12-19T12:18:51.867851Z", "completed_at": "2023-12-19T12:18:56.838809Z"}], "thread_id": "Thread-1", "execution_time": 4.97942590713501, "adapter_response": {"_message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_gross_margin_KSA\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_gross_margin_KSA__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect \t\t\tc.rep_month \n\t\t\t\t, c.date_nk \n\t\t\t\t, c.charging_id \n\t\t\t\t, c.Master_Account_ID \n\t\t\t\t, c.Master_Account_Name \n\t\t\t\t, c.cost_id \n\t\t\t\t, c.consumption \n\t\t\t\t, c.charge\n\t\t\t\t, c.chargeable_units\n\t\t\t\t, t.units as traffic\n\t\t\t\t, c.Revenue_USD \n\t\t\t\t, t.COGS_USD\n\t\t\t\t, case when t.COGS_USD is null then c.Revenue_USD\n\t\t\t\t\t   else c.Revenue_USD - t.COGS_USD \n\t\t\t\t\t   end as Gross_Profit_USD\n\t\t\t\t, c.GP_USD_estimate\n\t\t\t\t, case when t.COGS_USD is null or t.COGS_USD = 0 then null \n\t\t\t\t\t   else round(100*(c.Revenue_USD/t.COGS_USD - 1), 2) \n\t\t\t\t\t   end as Gross_Margin_pct\n\t\t\t\t, case when c.Revenue_USD is null or c.Revenue_USD = 0 then null\n\t\t\t\t\t   else round(100*(c.GP_USD_estimate/c.Revenue_USD), 2) \n\t\t\t\t\t   end as GM_pct_estimate\n\t\t\t\t, t.cost_rate_USD \n\t\t\t\t, t.cost_rate\n\t\t\t\t, t.currency\n\t\t\t\t, t.network_name\n\t\t\t\t, t.operator_name\n\t\t\t\t, c.categorized_charge_pct\n\t\t\t\t, c.charge_with_cost_id_pct\nfrom \t\t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA_agg\" as c\nleft join \t\t\"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover_agg\" as t\non\t\t\t\tc.date_nk = t.date_nk \n\t\t\t\tand c.cost_id = t.cost_id \n\t\t\t\tand c.charging_id = t.charging_id \nwhere \t\t\t1=1\n--order by \t\tcharging_id , cost_id\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "code": "None", "rows_affected": -1}, "message": "Operation: /* {\"app\": \"dbt\", \"dbt_version\": \"1.4.4\", \"profile_name\": \"GM\", \"target_name\": \"dev\", \"node_id\": \"model.GM.oy_dbt_gross_margin_KSA\"} */\n\n  \n    create  table\n    \"verticadb\".\"analytics\".\"oy_dbt_gross_margin_KSA__dbt_tmp\"\n    \n    INCLUDE SCHEMA PRIVILEGES as (\n    \n\nselect \t\t\tc.rep_month \n\t\t\t\t, c.date_nk \n\t\t\t\t, c.charging_id \n\t\t\t\t, c.Master_Account_ID \n\t\t\t\t, c.Master_Account_Name \n\t\t\t\t, c.cost_id \n\t\t\t\t, c.consumption \n\t\t\t\t, c.charge\n\t\t\t\t, c.chargeable_units\n\t\t\t\t, t.units as traffic\n\t\t\t\t, c.Revenue_USD \n\t\t\t\t, t.COGS_USD\n\t\t\t\t, case when t.COGS_USD is null then c.Revenue_USD\n\t\t\t\t\t   else c.Revenue_USD - t.COGS_USD \n\t\t\t\t\t   end as Gross_Profit_USD\n\t\t\t\t, c.GP_USD_estimate\n\t\t\t\t, case when t.COGS_USD is null or t.COGS_USD = 0 then null \n\t\t\t\t\t   else round(100*(c.Revenue_USD/t.COGS_USD - 1), 2) \n\t\t\t\t\t   end as Gross_Margin_pct\n\t\t\t\t, case when c.Revenue_USD is null or c.Revenue_USD = 0 then null\n\t\t\t\t\t   else round(100*(c.GP_USD_estimate/c.Revenue_USD), 2) \n\t\t\t\t\t   end as GM_pct_estimate\n\t\t\t\t, t.cost_rate_USD \n\t\t\t\t, t.cost_rate\n\t\t\t\t, t.currency\n\t\t\t\t, t.network_name\n\t\t\t\t, t.operator_name\n\t\t\t\t, c.categorized_charge_pct\n\t\t\t\t, c.charge_with_cost_id_pct\nfrom \t\t\t\"verticadb\".\"analytics\".\"oy_dbt_revenue_sms_KSA_agg\" as c\nleft join \t\t\"verticadb\".\"analytics\".\"oy_dbt_KSA_COGS_excl_failover_agg\" as t\non\t\t\t\tc.date_nk = t.date_nk \n\t\t\t\tand c.cost_id = t.cost_id \n\t\t\t\tand c.charging_id = t.charging_id \nwhere \t\t\t1=1\n--order by \t\tcharging_id , cost_id\n  )\n \n\n  \n\n    \n \n  ;\n\n  \n      \n        \n    \n\n      , Message: CommandComplete: command_tag = \"CREATE TABLE\", Code: None, Rows: -1, Arraysize: 1", "failures": null, "unique_id": "model.GM.oy_dbt_gross_margin_KSA"}], "elapsed_time": 45.513832092285156, "args": {"write_json": true, "use_colors": true, "printer_width": 80, "version_check": true, "partial_parse": true, "static_parser": true, "profiles_dir": "/Users/oleg/.dbt", "send_anonymous_usage_stats": true, "quiet": false, "no_print": false, "cache_selected_only": false, "which": "run", "rpc_method": "run", "indirect_selection": "eager"}}